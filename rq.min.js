"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};Object.defineProperty(exports,"__esModule",{value:!0});function soon(a){for(var c=arguments.length,b=Array(1<c?c-1:0),d=1;d<c;d++)b[d-1]=arguments[d];setTimeout.apply(void 0,[a,0].concat(b))}function expired(a,b){return{name:"expired",method:a,message:"expired after "+b,milliseconds:b}}function check(a,b,c){if(b.forEach(function(d,e){if("function"!=typeof d)throw{name:"TypeError",message:"not a function",array:b,index:e,method:a,value:d}}),void 0!==c&&("number"!=typeof c||0>c))throw{name:"TypeError",message:"milliseconds",method:a,value:c}}function check_callback(a,b){if("function"!=typeof b)throw new TypeError(a+" callback")}exports.default=Object.freeze({fallback:function(b,c){return check("RQ.fallback",b,c),function(e,f){function g(k,l){var m=e;if(i=void 0,m)return j&&clearTimeout(j),e=void 0,j=void 0,m(k,l)}function h(k){return e&&"function"==typeof i&&soon(i,k),g(void 0,k||!0)}var i,j;return check_callback("RQ.fallback",e),c&&(j=setTimeout(function(){return h(expired("RQ.fallback",c))},c)),function k(l,m){if("function"==typeof e){if(l>=b.length)return clearTimeout(j),i=void 0,h(m);var n=b[l];soon(function(){var o=!0;"function"==typeof e&&(i=n(function(q,s){if(o)return o=!1,i=void 0,void 0===s?g(q):k(l+1,s)},f))})}}(0),h}},parallel:function(b,c,d,e){var f;if("number"!=typeof c&&(e=d,d=c,c=void 0),"object"===("undefined"==typeof b?"undefined":_typeof(b))&&!Array.isArray(b)){f=Object.keys(b);var g=[];if(f.forEach(function(i){g.push(b[i])}),b=g,d){if("object"!==("undefined"==typeof d?"undefined":_typeof(d))||Array.isArray(d))throw{name:"TypeError",message:"object expected",method:"RQ.parallel",value:d};var h=Object.keys(d);f=f.concat(h),g=[],h.forEach(function(i){g.push(d[i])}),d=g}}if(check("RQ.parallel",b,c),d&&(check("RQ.parallel",d,e),0===d.length))throw{name:"TypeError",message:"optionals expected",method:"RQ.parallel",value:d};return function(j,k){function l(w,x){var y=j;if(y)return j=void 0,v&&(clearTimeout(v),v=void 0),u&&(clearTimeout(u),u=void 0),n.forEach(function(z){if("function"==typeof z)return soon(z,x)}),w&&f&&(t={},f.forEach(function(z,A){t[z]=w[A]}),w=t),n=void 0,t=void 0,y(w,x)}function m(w){return l(void 0,w||!0)}var o,u,v,n=[],p=0,q=b.length,s=b.length,t=[];return check_callback("RQ.parallel",j),c&&(v=setTimeout(function(){return v=void 0,0===s&&(0<q||0<p)?l(t):m(expired("RQ.parallel",c))},c)),e&&(u=setTimeout(function(){if(u=void 0,0===s)return l(t)},e)),b&&b.forEach(function(w,x){return soon(function(){var y=!0,z=w(function(B,C){if(y&&n){if(y=!1,n[x]=void 0,C)return m(C);if(t[x]=B,s-=1,0===s&&!u)return l(t)}},k);n&&void 0===n[x]&&(n[x]=z)})}),d&&(o=d.length,d.forEach(function(w,x){return soon(function(){var y=!0,z=w(function(B,C){if(y&&n&&(y=!1,n[q+x]=void 0,C||(t[q+x]=B,p+=1),o-=1,0===o)){if(0===s)return 0<q||0<p?l(t):m(C);u&&(clearTimeout(u),u=void 0)}},k);void 0===n[q+x]&&(n[q+x]=z)})})),m}},race:function(b,c){return check("RQ.race",b,c),function(e,f){function g(l,m){var n=e;if(n)return e=void 0,k&&clearTimeout(k),i.forEach(function(p){if("function"==typeof p)return soon(p)}),i=void 0,n(l,m)}function h(l){return g(void 0,l||!0)}var k,i=[],j=b.length;return check_callback("RQ.race",e),c&&(k=setTimeout(function(){return h(expired("RQ.race",c))},c)),b.forEach(function(l,m){return soon(function(){var n=!0,o=l(function(q,s){if(n&&i){if(n=!1,i[m]=void 0,!s)return g(q);if(j-=1,0===j)return h(s)}},f);i&&void 0===i[m]&&(i[m]=o)})}),h}},sequence:function(b,c){return check("RQ.sequence",b,c),function(e,f){function g(k,l){var m=e;if(i=void 0,m)return j&&clearTimeout(j),e=void 0,m(k,l)}function h(k){return e&&"function"==typeof i&&soon(i,k),g(void 0,k||!0)}var i,j;return check_callback("RQ.sequence",e),c&&(j=setTimeout(function(){return j=void 0,h(expired("RQ.sequence",c))},c)),function k(l){var m,n=e;if("function"==typeof n){if(l>=b.length)return j&&clearTimeout(j),e=void 0,i=void 0,n(f);m=b[l],soon(function(){var o=!0;i=m(function(q,s){if(o)return(o=!1,i=void 0,s)?h(s):(f=q,k(l+1))},f)})}}(0),h}}});